<%@ page import="java.sql.*" %>
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<html>
<head>
    <title>Formulario Empleados</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
</head>
<body class="bg-dark text-white">

<div class="container mt-5">
    <h3>Formulario Empleados</h3>
    <form method="post" action="empleados.jsp" class="row g-3">
        <div class="col-md-2">
            <label>ID</label>
            <input type="text" name="id" class="form-control" value="0">
        </div>
        <div class="col-md-2">
            <label>Codigo</label>
            <input type="text" name="codigo" class="form-control" placeholder="Ej: E001">
        </div>
        <div class="col-md-4">
            <label>Nombre</label>
            <input type="text" name="nombres" class="form-control" placeholder="Ej: Nombre1 Nombre2">
        </div>
        <div class="col-md-4">
            <label>Apellido</label>
            <input type="text" name="apellidos" class="form-control" placeholder="Ej: Apellido1 Apellido2">
        </div>
        <div class="col-md-6">
            <label>Direccion</label>
            <input type="text" name="direccion" class="form-control" placeholder="Ej: casa calle ave.">
        </div>
        <div class="col-md-3">
            <label>Telefono</label>
            <input type="text" name="telefono" class="form-control" placeholder="55554444">
        </div>
        <div class="col-md-3">
            <label>Fecha Nacimiento</label>
            <input type="date" name="fecha_nacimiento" class="form-control">
        </div>
        <div class="col-md-4">
            <label>Puesto</label>
            <select name="id_puesto" class="form-control">
                <option value="">Elige Puesto</option>
                <%
                    try {
                        Class.forName("com.mysql.cj.jdbc.Driver");
                        Connection con = DriverManager.getConnection("jdbc:mysql://localhost:3306/db_empresa2", "root", "User200@");
                        Statement st = con.createStatement();
                        ResultSet rs = st.executeQuery("SELECT id_puesto, puesto FROM puestos");
                        while (rs.next()) {
                %>
                        <option value="<%=rs.getInt("id_puesto")%>"><%=rs.getString("puesto")%></option>
                <%
                        }
                        con.close();
                    } catch (Exception e) {
                        out.println("Error: " + e.getMessage());
                    }
                %>
            </select>
        </div>

        <div class="col-12">
            <button type="submit" class="btn btn-primary">Crear</button>
            <button type="submit" class="btn btn-success">Actualizar</button>
            <button type="reset" class="btn btn-danger">Borrar</button>
        </div>
    </form>

    <hr>
    <h4>Lista de Empleados</h4>
    <table class="table table-dark table-hover">
        <thead>
            <tr>
                <th>Codigo</th>
                <th>Nombre</th>
                <th>Apellido</th>
                <th>Direcion</th>
                <th>Telefono</th>
                <th>Fecha_Nacimiento</th>
                <th>Puesto</th>
            </tr>
        </thead>
        <tbody>
            <%
                try {
                    Class.forName("com.mysql.cj.jdbc.Driver");
                    Connection con = DriverManager.getConnection("jdbc:mysql://localhost:3306/db_empresa2", "root", "User200@");
                    Statement st = con.createStatement();
                    ResultSet rs = st.executeQuery(
                        "SELECT e.codigo, e.nombres, e.apellidos, e.direccion, e.telefono, e.fecha_nacimiento, p.puesto " +
                        "FROM empleados e INNER JOIN puestos p ON e.id_puesto = p.id_puesto"
                    );
                    while (rs.next()) {
            %>
            <tr>
                <td><%=rs.getString("codigo")%></td>
                <td><%=rs.getString("nombres")%></td>
                <td><%=rs.getString("apellidos")%></td>
                <td><%=rs.getString("direccion")%></td>
                <td><%=rs.getString("telefono")%></td>
                <td><%=rs.getString("fecha_nacimiento")%></td>
                <td><%=rs.getString("puesto")%></td>
            </tr>
            <%
                    }
                    con.close();
                } catch (Exception e) {
                    out.println("<tr><td colspan='7'>Error: " + e.getMessage() + "</td></tr>");
                }
            %>
        </tbody>
    </table>
</div>

</body>
</html>
